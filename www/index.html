<!DOCTYPE html>
<html lang="en" ng-app="app" ng-csp>
<head>
    <meta charset="utf-8" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />

    <!-- CSS dependencies -->
    <link rel="stylesheet" href="lib/onsen/css/onsenui.css" />
    <link rel="stylesheet" href="lib/onsen/css/onsen-css-components.css" />
    <link rel="stylesheet" href="css/jquery-ui.css">
    <link rel="stylesheet" href="css/stylesheet.css">

    <title>Climahoje - Veja como está o clima hoje</title>
</head>

<body>
    <div style="display: none;" title="Aguarde" id='aguarde' class="modal" tabindex="-1">
      <div style="text-align: center;color: #666">
      <ons-icon icon="circle-o-notch" spin size="26px"></ons-icon>
      Por favor, aguarde um momento...
      </div>
    </div>


    <ons-navigator id="appNavigator" swipeable swipe-target-width="80px">
      <ons-page>
        <ons-splitter id="appSplitter">
          <ons-splitter-side id="sidemenu" page="sidemenu.html" swipeable side="right" collapse="" width="260px"></ons-splitter-side>
          <ons-splitter-content page="tabbar.html"></ons-splitter-content>
        </ons-splitter>
      </ons-page>
    </ons-navigator>

    <template id="tabbar.html">
      <ons-page id="tabbar-page">
        <ons-toolbar>
          <div class="center">Home</div>
          <div class="right">
            <ons-toolbar-button onclick="fn.toggleMenu()">
              <ons-icon icon="fa-info-circle"></ons-icon>
            </ons-toolbar-button>
          </div>
        </ons-toolbar>
        <ons-tabbar swipeable id="appTabbar" position="auto">
          <ons-tab label="Home" icon="fa-home" page="home.html" active></ons-tab>
          <ons-tab label="Filtro" icon="fa-filter" page="forms.html"></ons-tab>
          <ons-tab label="Próximos 6 dias" icon="fa-calendar-alt" page="animations.html"></ons-tab>
        </ons-tabbar>

        <script>
          ons.getScriptPage().addEventListener('prechange', function(event) {
            if (event.target.matches('#appTabbar')) {
              event.currentTarget.querySelector('ons-toolbar .center').innerHTML = event.tabItem.getAttribute('label');
            }
          });
        </script>
      </ons-page>
    </template>

    <template id="sidemenu.html">
      <ons-page>
        <div class="profile-pic">
          <img src="img/icon.png">
        </div>

        <ons-list-title>Acesso rapído</ons-list-title>
        <ons-list>
          <ons-list-item onclick="fn.loadView(0)">
            <div class="left">
              <ons-icon fixed-width class="list-item__icon" icon="fa-home"></ons-icon>
            </div>
            <div class="center">
              Home
            </div>
            <div class="right">
              <ons-icon icon="fa-link"></ons-icon>
            </div>
          </ons-list-item>
          <ons-list-item onclick="fn.loadView(1)">
            <div class="left">
              <ons-icon fixed-width class="list-item__icon " icon="fa-filter"></ons-icon>
            </div>
            <div class="center">
              Filtro
            </div>
            <div class="right">
              <ons-icon icon="fa-link"></ons-icon>
            </div>
          </ons-list-item>
          <ons-list-item onclick="fn.loadView(2)">
            <div class="left">
              <ons-icon fixed-width class="list-item__icon" icon="fa-calendar-alt"></ons-icon>
            </div>
            <div class="center">
              Próximos 6 dias
            </div>
            <div class="right">
              <ons-icon icon="fa-link"></ons-icon>
            </div>
          </ons-list-item>
        </ons-list>

        <ons-list-title style="margin-top: 10px">Links</ons-list-title>
        <ons-list>
          <ons-list-item onclick="fn.loadLink('https://miqueiasmcaetano.000webhostapp.com')">
            <div class="left">
              <ons-icon fixed-width class="list-item__icon" icon="fa-globe"></ons-icon>
            </div>
            <div class="center">
              Site
            </div>
            <div class="right">
              <ons-icon icon="fa-external-link"></ons-icon>
            </div>
          </ons-list-item>
          <ons-list-item onclick="fn.loadLink('https://github.com/miqueias91')">
            <div class="left">
              <ons-icon fixed-width class="list-item__icon" icon="fa-github"></ons-icon>
            </div>
            <div class="center">
              GitHub
            </div>
            <div class="right">
              <ons-icon icon="fa-external-link"></ons-icon>
            </div>
          </ons-list-item>
          <ons-list-item onclick="fn.loadLink('https://www.linkedin.com/in/miqueias-matias-caetano-21902068/')">
            <div class="left">
              <ons-icon fixed-width class="list-item__icon" icon="fa-linkedin-in"></ons-icon>
            </div>
            <div class="center">
              LinkedIn
            </div>
            <div class="right">
              <ons-icon icon="fa-external-link"></ons-icon>
            </div>
          </ons-list-item>
          <ons-list-item onclick="fn.loadLink('https://www.facebook.com/miqueiasmatiascaetano')">
            <div class="left">
              <ons-icon fixed-width class="list-item__icon" icon="fa-facebook-f"></ons-icon>
            </div>
            <div class="center">
              Facebook
            </div>
            <div class="right">
              <ons-icon icon="fa-external-link"></ons-icon>
            </div>
          </ons-list-item>
        </ons-list>

        <script>
          ons.getScriptPage().onInit = function() {
            // Set ons-splitter-side animation
            this.parentElement.setAttribute('animation', ons.platform.isAndroid() ? 'overlay' : 'reveal');
          };
        </script>

        <style>
          .profile-pic {
            width: 200px;
            background-color: #fff;
            margin: 20px auto 10px;
            border: 1px solid #999;
            border-radius: 4px;
          }

          .profile-pic > img {
            display: block;
            max-width: 100%;
          }

          ons-list-item {
            color: #444;
          }
        </style>
      </ons-page>
    </template>

    <template class="homePage" id="home.html">

      <ons-page>
        <ons-pull-hook id="pull-hook" threshold-height="120px">
          <ons-icon id="pull-hook-icon" size="22px" class="pull-hook-content" icon="fa-arrow-down"></ons-icon>
        </ons-pull-hook>
        
        <ons-list id="kitten-list">
          <div id="vaziaPesquisa" class="container" style="display: none;">
            <p class="intro" >
              Nenhuma pesquisa encontrada, utilize o filtro.<br><br>
            </p>            
          </div>

          <div class="container">

            <div id="resultadoTempo" class="main" style="display:none;">
              <h2><i class="fas fa-location-arrow"></i>&nbsp;<span>XXXXXXX - XX, XX</span></h2> 
              <br>
              <div class="dadosTemperatura">
                <h1>00ºC</h1>
                <h2><span class="diaSemana">XXXXXXXXX</span></h2>
                <h2><span class="situacao">XXXXXXXXX</span></h2>
                <h4>Máxima:&nbsp;<span class="maxima">00</span>ºC</h4>
                <h4>Mínima:&nbsp;<span class="minima">00</span>ºC</h4>
              </div>
              <br>
              <h3>Atualizado em: <span class="data">XX/XX/XXXX</span></h3>  
              <h3>Fonte: CPTEC/INPE</h3>
              <br>  
            </div>      
          </div>  
        </ons-list>

        <script>
          var nome = window.localStorage.getItem('nome');

          setTimeout(function() {
            if (nome !== null) {
              var uf = window.localStorage.getItem('uf');
              var temp_media0 = window.localStorage.getItem('temp_media0');
              var maxima0 = window.localStorage.getItem('maxima0');
              var minima0 = window.localStorage.getItem('minima0');
              var tempo0 = window.localStorage.getItem('tempo0');
              var data_atualizacao = window.localStorage.getItem('data_atualizacao');
              var dia1 = window.localStorage.getItem('dia1');
              
              $('#resultadoTempo h2 span').html(nome+' - '+uf+', BR');
              $('.dadosTemperatura h1').html(temp_media0+'ºC');
              $('.dadosTemperatura h2 .diaSemana').html(dia1);
              $('.dadosTemperatura h2 .situacao').html(clima[tempo0]);
              $('.dadosTemperatura h4 .maxima').html(maxima0);
              $('.dadosTemperatura h4 .minima').html(minima0);

              $('#resultadoTempo h3 .data').html(data_atualizacao);

              $("#resultadoTempo").css('display', '');
              $("div#vaziaPesquisa.container").html('');
            }
            else{
              $("#resultadoTempo").css('display', 'none');
              $("#vaziaPesquisa").css('display', '');
            }
          },400);

          ons.getScriptPage().onInit = function () {
            var pullHook = document.getElementById('pull-hook');
            var icon = document.getElementById('pull-hook-icon');


            pullHook.addEventListener('changestate', function (event) {
              switch (event.state) {
                case 'initial':
                  icon.setAttribute('icon', 'fa-arrow-down');
                  icon.removeAttribute('rotate');
                  icon.removeAttribute('spin');
                  break;
                case 'preaction':
                  icon.setAttribute('icon', 'fa-arrow-down');
                  icon.setAttribute('rotate', '180');
                  icon.removeAttribute('spin');
                  break;
                case 'action':
                  icon.setAttribute('icon', 'fa-spinner');
                  icon.removeAttribute('rotate');
                  icon.setAttribute('spin', true);
                  break;
              }
            });           
            var createKitten = function () {
              var estado = window.localStorage.getItem('estado');
              var municipio = window.localStorage.getItem('municipio');
              buscaClimaMunicipio(municipio, estado);
            };
            pullHook.onAction = function (done) {
              setTimeout(function() {
                createKitten()
                done();
              }, 400);
            }
          };
        </script>
        <style>
          .pull-hook-content {
            color: #666;
            transition: transform .25s ease-in-out;
          }
        </style>
      </ons-page>
    </template>

    <template id="forms.html">
      <ons-page id="forms-page">

        <ons-list>
        <ons-list-header style='text-align: center;padding-top: 20px; padding-bottom: 20px;font-size: 17px;font-weight: 500;color: #1f1f21;'>Informe o estado e o município</ons-list-header>
          <ons-list-header>Estado</ons-list-header>
          <ons-list-item>
            <div class="center">
              <ons-input type="hidden" id="estado" name="estado" value=""></ons-input>
              <ons-input type="hidden" id="municipio" name="municipio" value=""></ons-input> 

              <ons-select id="select-estado" style="width: 100%">
                <option value="">Estado</option>
                <option sigla="AC" value="12">Acre - AC</option>
                <option sigla="AL" value="27">Alagoas - AL</option>
                <option sigla="AM" value="13">Amazonas - AM</option>
                <option sigla="AP" value="16">Amapá - AP</option>
                <option sigla="BA" value="29">Bahia - BA</option>
                <option sigla="CE" value="23">Ceará - CE</option>
                <option sigla="DF" value="53">Distrito Federal - DF</option>
                <option sigla="ES" value="32">Espírito Santo - ES</option>
                <option sigla="GO" value="52">Goiás - GO</option>
                <option sigla="MA" value="21">Maranhão - MA</option>
                <option sigla="MT" value="51">Mato Grosso - MT</option>
                <option sigla="MS" value="50">Mato Grosso do Sul - MS</option>
                <option sigla="MG" value="31">Minas Gerais - MG</option>
                <option sigla="PA" value="15">Pará - PA</option>
                <option sigla="PB" value="25">Paraíba - PB</option>
                <option sigla="PR" value="41">Paraná - PR</option>
                <option sigla="PI" value="22">Piauí - PI</option>
                <option sigla="PE" value="26">Pernambuco - PE</option>
                <option sigla="RJ" value="33">Rio de Janeiro - RJ</option>
                <option sigla="RN" value="24">Rio Grande do Norte - RN</option>
                <option sigla="RS" value="43">Rio Grande do Sul - RS</option>
                <option sigla="RO" value="11">Rondônia - RO</option>
                <option sigla="RR" value="14">Roraima - RR</option>
                <option sigla="SP" value="35">São Paulo - SP</option>
                <option sigla="SC" value="42">Santa Catarina - SC</option>
                <option sigla="SE" value="28">Sergipe - SE</option>
                <option sigla="TO" value="17">Tocantins - TO</option>
              </ons-select>
            </div>
          </ons-list-item>

          <ons-list-header>Município</ons-list-header>
          <ons-list-item>
            <div class="center">
              <ons-select id="select-municipio" style="width: 100%">
                <select id="localizaMunicipio">
                  <option value="">Município</option>                  
                </select>
              </ons-select>
            </div>
          </ons-list-item>     
          <br>
        </ons-list>

        <script>
          ons.getScriptPage().onInit = function () {
            //BUSCA O OS MUNICIPIOS DO ESTADO SELECIONADO
            $('#select-estado').change(function(){
              $('#aguarde').dialog('open');
              if ($(this).val() !== '') {
                  $.ajax({
                      url: "https://climahoje.000webhostapp.com/webservice/climahojemobile/buscaMunicipio.php",
                      dataType: 'html',
                      type: 'GET',
                      data: {
                        'uf': $('option:selected', this).attr('sigla'),
                      },
                      error: function(a) {
                        $('#aguarde').dialog('close');
                        ons.notification.alert("Erro na comunicação, tente novamente. Se o erro persistir verifique sua conexão com a internet.");
                        //window.location.reload();
                      },
                      success: function(a) {
                        if (a === 'ERROR') {
                          $('#aguarde').dialog('close');
                          ons.notification.alert('Atenção! Selecione um estado.');
                        }else{
                          $('#aguarde').dialog('close');
                          $('#localizaMunicipio').html("<option value=''>Município</option>\n"+a);
                        }
                      },
                  });
              }
              else{
                $('#aguarde').dialog('close');
                ons.notification.alert('Atenção! Selecione um estado.');
                $('#localizaMunicipio').html("<option value=''>Município</option>");
              }
            });

            //BUSCA O CLIMA DO MUNICIPIO SELECIONADO
            $('#select-municipio').change(function(){
              $('#aguarde').dialog('open');
              if ($(this).val() !== '') {
                var municipio = $('option:selected', this).attr('localidade');
                var estado = $('option:selected', '#select-estado').attr('sigla');                
                buscaClimaMunicipio(municipio, estado);                
              }
              else{
                $('#aguarde').dialog('close');
                ons.notification.alert('Atenção! Selecione um município.');
              }
            });           
          }
        </script>
        <style>
          .right-icon {
            margin-left: 10px;
          }
          .right-label {
            color: #666;
          }
        </style>
      </ons-page>
    </template>

    <template id="animations.html">
      <ons-page>
        <ons-list>
          <ons-list-header>Previsão Diária</ons-list-header>
          <ons-list-item style="width: 100%">
            <div id="dia1" style="width: 33.3333%">XX, XX/XX</div><div style="width: 33.3333%" id="temp1">XXºC</div><div style="width: 33.3333%" id="previsaodia1">XXX</div>
          </ons-list-item>

          <ons-list-item style="width: 100%">
            <div id="dia2" style="width: 33.3333%">XX, XX/XX</div> <div style="width: 33.3333%" id="temp2" >XXºC</div><div style="width: 33.3333%" id="previsaodia2">XXX</div>
          </ons-list-item>

          <ons-list-item style="width: 100%">
            <div id="dia3" style="width: 33.3333%">XX, XX/XX</div> <div style="width: 33.3333%" id="temp3" >XXºC</div><div style="width: 33.3333%" id="previsaodia3">XXX</div>
          </ons-list-item>

          <ons-list-item style="width: 100%">
            <div id="dia4" style="width: 33.3333%">XX, XX/XX</div> <div style="width: 33.3333%" id="temp4" >XXºC</div><div style="width: 33.3333%" id="previsaodia4">XXX</div>
          </ons-list-item>

          <ons-list-item style="width: 100%">
            <div id="dia5" style="width: 33.3333%">XX, XX/XX</div> <div style="width: 33.3333%" id="temp5" >XXºC</div><div style="width: 33.3333%" id="previsaodia5">XXX</div>
          </ons-list-item>

          <ons-list-item style="width: 100%">
            <div id="dia6" style="width: 33.3333%">XX, XX/XX</div> <div style="width: 33.3333%" id="temp6" >XXºC</div><div style="width: 33.3333%" id="previsaodia6">XXX</div>
          </ons-list-item>
        </ons-list>
        <script>
            var temp1 = window.localStorage.getItem('temp1');
            var dia1 = window.localStorage.getItem('dia1');
            var previsaodia1 = window.localStorage.getItem('previsaodia1');

            var temp2 = window.localStorage.getItem('temp2');
            var dia2 = window.localStorage.getItem('dia2');
            var previsaodia2 = window.localStorage.getItem('previsaodia2');

            var temp3 = window.localStorage.getItem('temp3');
            var dia3 = window.localStorage.getItem('dia3');
            var previsaodia3 = window.localStorage.getItem('previsaodia3');

            var temp4 = window.localStorage.getItem('temp4');
            var dia4 = window.localStorage.getItem('dia4');
            var previsaodia4 = window.localStorage.getItem('previsaodia4');

            var temp5 = window.localStorage.getItem('temp5');
            var dia5 = window.localStorage.getItem('dia5');
            var previsaodia5 = window.localStorage.getItem('previsaodia5');

            var temp6 = window.localStorage.getItem('temp6');
            var dia6 = window.localStorage.getItem('dia6');
            var previsaodia6 = window.localStorage.getItem('previsaodia6');

            $('#dia1').html(dia1);
            $('#previsaodia1').html(previsaodia1);            
            if (temp1 !== null) {              
              $('#temp1').html(temp1+'ºC');
            }
            else{
              $('#temp1').html('');
            }

            $('#dia2').html(dia2);
            $('#previsaodia2').html(previsaodia2);
            if (temp2 !== null) {              
              $('#temp2').html(temp2+'ºC');
            }
            else{
              $('#temp2').html('');
            }

            $('#dia3').html(dia3);
            $('#previsaodia3').html(previsaodia3);
            if (temp3 !== null) {              
              $('#temp3').html(temp3+'ºC');
            }
            else{
              $('#temp3').html('');
            }
            
            $('#dia4').html(dia4);
            $('#previsaodia4').html(previsaodia4);
            if (temp4 !== null) {              
              $('#temp4').html(temp4+'ºC');
            }
            else{
              $('#temp4').html('');
            }
            
            $('#dia5').html(dia5);
            $('#previsaodia5').html(previsaodia5);
            if (temp5 !== null) {              
              $('#temp5').html(temp5+'ºC');
            }
            else{
              $('#temp5').html('');
            }
            
            $('#dia6').html(dia6);
            $('#previsaodia6').html(previsaodia6);
            if (temp6 !== null) {              
              $('#temp6').html(temp6+'ºC');
            }
            else{
              $('#temp6').html('');
            }
          </script>
      </ons-page>
    </template>

 

    <!-- JS dependencies (order matters!) -->
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script src="js/jquery.3.3.1.js"></script>
    <script src="lib/onsen/js/onsenui.js"></script>
    <script src="js/script_onsen.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/onesignal.js"></script>
    <script src="js/player_ids.js"></script>
    <script src="js/script.js"></script>
    <script type="text/javascript">
        app.initialize();
    </script>
</body>

</html>
